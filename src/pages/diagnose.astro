---
---

<html>
<head>
  <meta charset="utf-8" />
  <title>ç³»ç»Ÿè¯Šæ–­</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      line-height: 1.6;
    }
    h1 { color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
    h2 { color: #555; margin-top: 30px; }
    .status {
      padding: 15px;
      margin: 10px 0;
      border-radius: 5px;
    }
    .success { background: #d4edda; border: 1px solid #c3e6cb; }
    .error { background: #f8d7da; border: 1px solid #f5c6cb; }
    .warning { background: #fff3cd; border: 1px solid #ffeeba; }
    .info { background: #d1ecf1; border: 1px solid #bee5eb; }
    .details {
      margin-top: 20px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 5px;
    }
    code {
      background: #e9ecef;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }
    ul { margin: 10px 0; padding-left: 20px; }
    li { margin: 5px 0; }
  </style>
</head>
<body>
  <h1>ğŸ” ç³»ç»Ÿè¯Šæ–­å·¥å…·</h1>

  <div id="results"></div>

  <div class="details">
    <h2>ğŸ“‹ ç¯å¢ƒå˜é‡æ£€æŸ¥</h2>
    <ul>
      <li><strong>VITE_TURSO_DATABASE_URL:</strong> <code id="env-db-url">æ£€æŸ¥ä¸­...</code></li>
      <li><strong>VITE_TURSO_AUTH_TOKEN:</strong> <code id="env-auth-token">æ£€æŸ¥ä¸­...</code></li>
      <li><strong>VITE_JWT_SECRET:</strong> <code id="env-jwt-secret">æ£€æŸ¥ä¸­...</code></li>
    </ul>

    <h2>ğŸ”Œ API ç«¯ç‚¹æµ‹è¯•</h2>
    <ul>
      <li><strong>Health Check:</strong> <span id="test-health">æ£€æŸ¥ä¸­...</span></li>
      <li><strong>Posts API:</strong> <span id="test-posts">æ£€æŸ¥ä¸­...</span></li>
      <li><strong>Categories API:</strong> <span id="test-categories">æ£€æŸ¥ä¸­...</span></li>
      <li><strong>Tags API:</strong> <span id="test-tags">æ£€æŸ¥ä¸­...</span></li>
    </ul>

    <h2>â“ å¯èƒ½çš„é—®é¢˜</h2>
    <div class="status warning">
      <strong>å¦‚æœæ‰€æœ‰ API éƒ½å¤±è´¥ï¼š</strong>
      <ul>
        <li>Turso æ•°æ®åº“æœªåˆå§‹åŒ–ï¼ˆéœ€è¦æ‰§è¡Œ init-turso.sqlï¼‰</li>
        <li>EdgeOne Pages ç¯å¢ƒå˜é‡æœªé…ç½®</li>
        <li>ç¯å¢ƒå˜é‡å€¼ä¸æ­£ç¡®</li>
      </ul>
    </div>

    <h2>ğŸ“ è§£å†³æ–¹æ¡ˆ</h2>
    <div class="status info">
      <ol>
        <li><strong>åˆ›å»º Turso æ•°æ®åº“ï¼š</strong><br>
          è®¿é—® <a href="https://turso.tech" target="_blank">https://turso.tech</a> åˆ›å»ºæ•°æ®åº“
        </li>
        <li><strong>åˆå§‹åŒ–æ•°æ®åº“è¡¨ï¼š</strong><br>
          åœ¨ Turso Shell ä¸­æ‰§è¡Œ <code>init-turso.sql</code> è„šæœ¬
        </li>
        <li><strong>é…ç½®ç¯å¢ƒå˜é‡ï¼š</strong><br>
          åœ¨ EdgeOne Pages æ§åˆ¶å°æ·»åŠ ç¯å¢ƒå˜é‡
        </li>
        <li><strong>é‡æ–°éƒ¨ç½²ï¼š</strong><br>
          ç­‰å¾… EdgeOne Pages è‡ªåŠ¨é‡æ–°æ„å»º
        </li>
      </ol>
    </div>
  </div>

  <script>
    async function testAPI(url: string) {
      try {
        const response = await fetch(url);
        const text = await response.text();

        let data;
        try {
          data = JSON.parse(text);
        } catch (e) {
          data = { error: text.substring(0, 200) };
        }

        return {
          success: response.ok,
          status: response.status,
          data
        };
      } catch (error) {
        return {
          success: false,
          error: error instanceof Error ? error.message : String(error)
        };
      }
    }

    async function checkEnvironment() {
      const dbUrl = import.meta.env.VITE_TURSO_DATABASE_URL;
      const authToken = import.meta.env.VITE_TURSO_AUTH_TOKEN;
      const jwtSecret = import.meta.env.VITE_JWT_SECRET;

      const dbUrlEl = document.getElementById('env-db-url');
      const authTokenEl = document.getElementById('env-auth-token');
      const jwtSecretEl = document.getElementById('env-jwt-secret');
      const resultsEl = document.getElementById('results');

      if (dbUrlEl) dbUrlEl.textContent = dbUrl ? 'âœ… å·²è®¾ç½®' : 'âŒ æœªè®¾ç½®';
      if (authTokenEl) authTokenEl.textContent = authToken ? 'âœ… å·²è®¾ç½®' : 'âŒ æœªè®¾ç½®';
      if (jwtSecretEl) jwtSecretEl.textContent = jwtSecret ? 'âœ… å·²è®¾ç½®' : 'âŒ æœªè®¾ç½®';

      if (!dbUrl || !authToken || !jwtSecret) {
        if (resultsEl) {
          resultsEl.innerHTML += `
            <div class="status error">
              <strong>âŒ ç¯å¢ƒå˜é‡ç¼ºå¤±</strong>
              <p>è¯·é…ç½® EdgeOne Pages ç¯å¢ƒå˜é‡ï¼š</p>
              <ul>
                <li>VITE_TURSO_DATABASE_URL</li>
                <li>VITE_TURSO_AUTH_TOKEN</li>
                <li>VITE_JWT_SECRET</li>
              </ul>
            </div>
          `;
        }
      } else {
        if (resultsEl) {
          resultsEl.innerHTML += `
            <div class="status success">
              <strong>âœ… ç¯å¢ƒå˜é‡å·²é…ç½®</strong>
            </div>
          `;
        }
      }
    }

    async function testAPIs() {
      const tests = [
        { name: 'Health', url: '/health', elementId: 'test-health' },
        { name: 'Posts', url: '/posts', elementId: 'test-posts' },
        { name: 'Categories', url: '/categories', elementId: 'test-categories' },
        { name: 'Tags', url: '/tags', elementId: 'test-tags' },
      ];

      for (const test of tests) {
        const element = document.getElementById(test.elementId);
        const result = await testAPI(test.url);

        if (element) {
          if (result.success && result.status === 200 && result.data.success) {
            element.innerHTML = `<span style="color: green;">âœ… æ­£å¸¸ (${result.status} OK)</span>`;
          } else {
            element.innerHTML = `<span style="color: red;">âŒ å¤±è´¥ (${result.status})</span>`;

            if (result.data && result.data.error) {
              element.innerHTML += `<br><small>${result.data.error}</small>`;
            }
          }
        }
      }
    }

    // é¡µé¢åŠ è½½åæ‰§è¡Œæ£€æŸ¥
    document.addEventListener('DOMContentLoaded', async () => {
      await checkEnvironment();
      await testAPIs();
    });
  </script>
</body>
</html>
